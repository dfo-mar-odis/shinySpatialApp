---
output:
  bookdown::html_document2:
    number_sections: FALSE
    theme: paper
bibliography: '`r here::here("app/data/mybiblio.bib")`'
---
```{r snowCrabTrawl-load-common, child = here::here("reports/sections/commonSections/commonIntro.Rmd")}
``` 

```{r eval=FALSE}
if (FALSE) { #load in data:
  lapply(list.files(here::here("reports/R"), pattern = ".[Rr]$", full.names = TRUE), source)
  studyArea <- sf::st_read(here::here("app/output/geoms_slc.geojson")) 
  intro_setup(studyArea, env = environment())  
}
```

### **Snow Crab Trawl Survey** {#snowCrabTrawl-section}  

```{r snowCrabTrawl-load, include=FALSE}
load_rdata(c("snowCrabTrawl_rr"), regionStr, env = environment())
```

```{r snowCrabTrawl-meta, results='asis'}
write_meta(snowCrabTrawl_rr, "EN")
```

The annual Eastern Nova Scotia (ENS) Snow Crab Trawl Survey is conducted on the Scotian Shelf to assess the snow crab (Chionoecetes opilio) stocks in the Maritimes Region. This program is fully funded through a Collaborative Agreement between DFO Science and all members of the Maritimes Region Snow Crab Fishing Industry. 

This survey is a fixed station design that uses a modified small mesh “Nephrops” trawl to capture snow crab across their size spectrum with constant monitoring and recording of trawl dimensions through a geo-referenced trawl monitoring / mensuration system. Bottom water temperature is also recorded for each tow. All of the trawl catch from each tow is separated, weighed and counted by species. All crab species are examined in more detail with morphometric measurements recorded for each animal.

Data requests are subject to the terms of the Collaborative Agreement. Please contact Kate Christie (DFO Snow Crab Biologist, Kate.Christie@dfo-mpo.gc.ca) with details on your request, and you will be guided through the Snow crab Trawl Survey data request process. 

##### *Area-Specific Snow Crab Search Results*

```{r snowCrabTrawl-results, include=FALSE, cache=FALSE}
# clip the data to the Study and Map areas:
scOutputList <- master_intersect(snowCrabTrawl_rr$data_sf, 
                                              mapDataList, getRegion = TRUE)

# summary intro table
introResult <- !is.null(scOutputList$studyData)
summaryIntroTable <- add_row_to_intro_summary(summaryIntroTable, name="[Snow Crab Trawl](#snowCrabTrawl-section)", result=introResult)

# gen table:
if (!is.null(scOutputList$studyData)) {
  scStudyData <- sf::st_drop_geometry(scOutputList$studyData)
  scTable <- scStudyData %>%
    dplyr::select(year, AREA, STATION) %>%
    dplyr::group_by(year, AREA) %>%
    dplyr::summarize(number_of_tows = n()) %>%
    tidyr::spread(AREA, number_of_tows)
  
  names(scTable)[1] <- "Year"
 
}

```

```{r snowCrabTrawl-check, echo=FALSE, results='asis',}
# Check if there is any data in the study area
snowCrabReport <- if (is.null(scOutputList$studyData)) {
  "* There are no relevant Snow Crab survey records for this search area."
} else {
  "* There are relevant Snow Crab survey records for this search area."
}
writeLines(noquote(snowCrabReport))
```


```{r snowCrabTrawl-area-plot, fig.height=7, fig.width=11, fig.cap=paste(write_caption_blurb(snowCrabTrawl_rr, "EN"), 'Map showing the search area defined by the user (red outline) to query information and automatically generate this report.')}
if (!is.null(scOutputList$studyData)) {
  
  labelData <- dplyr::filter(labels, AREA %in% scOutputList$mapData$AREA)
  # common plotting function:
  plot_rr_sf(areaMap, scOutputList$mapData, attribute = 
               snowCrabTrawl_rr$attribute, labelData = labelData, 
             labelAttribute = "AREA")
}
```


```{r snowCrabTrawl-table}
if (!is.null(scOutputList$studyData)) {
  if (nrow(scTable) > 0) {
     options(knitr.kable.NA = '--')
    knitr::kable(scTable, align = "l", caption = paste("\\label{tab:snowCrabTrawl_table}", write_caption_blurb(snowCrabTrawl_rr, "EN"), 'Number of tows per year by Area from Snow Crab Trawl surveys. Note: The tows listed under 2020 are from the 2019 survey that extended into January of 2020.  The 2020 survey did not take place due to the Covid-19 pandemic.'), booktabs = T, escape = F, linesep = "") %>% kable_styling(bootstrap_options = "striped", full_width = T, position = "center")
  }
}
```


### Additional information: 

[Maritimes Region snow crab trawl survey: detailed techical description.](https://publications.gc.ca/site/eng/9.800326/publication.html)

[Assessment of Scotian Shelf Snow Crab (Chionoecetes opilio)](https://www.dfo-mpo.gc.ca/csas-sccs/Publications/SAR-AS/2020/2020_042-eng.html)

[Snow Crab - Eastern Nova Scotia - Industry Website (Chionoecetes opilio)](https://www.enssnowcrab.com/index.html)


