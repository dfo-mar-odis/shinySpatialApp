---
title: "Reproducible Report for Internal DFO Use Only - Protected B - Do Not Share"
subtitle: "{{u_text}}"
author: "Report generated by: {{u_name}} ({{u_email}})"
date: '`r format(Sys.time(), "%d %B, %Y")`'
output:
  bookdown::html_document2:
    number_sections: FALSE
    theme: paper
    toc: true
    toc_depth: 5
    toc_float:
      collapsed: false
bibliography: '`r here::here("app/data/mybiblio.bib")`'
---

```{r setup, include = FALSE, cache = FALSE}
knitr::opts_chunk$set(
  echo = FALSE, 
  warning = FALSE,
  message = FALSE, 
  fig.path = "figs/")
```


```{r child = here::here("reports/sections/commonSections/commonIntro.Rmd")}
```

For more information about this report, please contact Quentin.Stoyel@dfo-mpo.gc.ca. Please circulate this report to all relevant contacts provided in each section to verify and supplement information.

# **REPRODUCIBLE REPORTING: ABOUT THIS DATA DISCOVERY TOOL** 

``` {r user-comments, results = 'asis'}
if (nchar("{{u_comments}}") > 0){
  commentSection <- "#### **Comments provided by user** \n\n
{{u_comments}}"
  writeLines(noquote(commentSection))
}
```

##### *Background*

This document compiles and summarizes regional data to increase reporting efficiency and facilitate more time-effective decision making. In response to repeat requests for available data, this report has been developed as an automated tool to document all available data within a user-defined search area. This helps streamline the process of generating science information and advice relevant to a variety of cross-sectoral departmental assessments, regulatory reviews, and reporting activities and is intended to provide information for various applications including aquaculture management, resource management, marine planning and conservation, emergency response, the Fish and Habitat Protection Program, and the Species at Risk program.

The datasets summarized in this report have been compiled from a variety of sources including internal DFO databases, governmental and academic research labs, and open-source databases. This report will be continuously updated as new sources become available. These data comprise a variety of types (e.g., points, vector datasets, raster information), with the primary focus being species presence. However, recognizing the importance of considering ecosystem-based approaches for management, this report also includes information on ecosystem components (e.g., coastal habitat), areas designated for spatial planning (e.g., Ecologically and Biologically Significant Areas), and human activities,

Data summaries and products (e.g., plots and tables) are presented in the report with source descriptions, caveats, disclaimers, sources of uncertainty, references to the literature, and contacts who can provide further interpretation. Currently, the report has the ability to summarize information from different sources and themes. Also, not all sections may be available in each rendered report, since users have the ability to interactively select the modules to be included.


```{r area-map-plot, fig.height=8, fig.width=11, fig.show="hold", out.width="50%", fig.cap="Map showing the search area defined by the user (red outline) to query information and automatically generate this report (left).  Map showing the study area's location relative to the DFO Maritimes Region (right).  Dashed grey line indicates international boundries."}
graphics::par(mar = c(4, 4, .1, .1))
mapDataList$areaMap
mapDataList$regionMap

```


##### *System*

This document is developed as a reproducible reporting tool, supported by the R Markdown language, and generated by an R Shiny application interface hosted on the DFO network (http://dmapps:3838/shinySpatialApp/app/). Report summaries and outputs are based on data extracted from a user-provided search area (Figure 1). Instructions for use of the R Shiny interface are provided in the GitHub repository (https://github.com/dfo-mar-odis/shinySpatialApp) and infographic (https://github.com/dfo-mar-odis/shinySpatialApp/blob/master/app/data/misc/how-to-use-reproducible-reports.pdf). Due to the potential sensitivity of some data and information, access to the data in the application has to be granted by the authoritative data provider/custodian, and the report is intended for internal DFO use only.

##### *Disclaimers*

This report is intended to provide a first-order view of the data available within the search area. Users are requested to review the caveats and disclaimers below to use information appropriately.

- This document is a tool to support, not to replace, science advice and peer-review processes.
- This report does not endeavor to describe every source of information available. The data presented does not represent all available data within the search area and additional information may be available from other sources, or more recent data may be available than what is presented here.
- This report is not intended to provide the data itself, but to summarize what is available. Users are encouraged to:
  - Access the original data source if more information is required,
  - Circulate this document to all contacts outlined in the different sections of the report for each data source, to ensure its veracity, and to provide any supplemental information that may support the provision of science advice.
- Data and metadata summarized in this report may change frequently because different sources of information may change, or may get updated, without prior notice. Consequently, reports may summarize different outputs of the same polygon depending on their date of creation. 
-	The focus of this report is on available observations of species presence and not on absences, quantities (e.g., species abundance or biomass), frequency, or catch information.
-	The absence of a species in this report should be interpreted as an absence of observation or reporting of the species within the user-defined search area, not necessarily as a true absence of the species.
-	Unless otherwise specified, data were queried from 2010 to present. This was selected as an arbitrary time range to present the most recent information. Please contact data providers if data outside of these ranges are required.
-	Current outputs of species observations in the report aggregate all years in summary plots and tables (e.g., 2010-2021). Annual summaries are not displayed. If you require annual summaries or other information beyond species presence, please contact relevant data providers/custodians for each data source.
-	All maps in this report are for informational purposes and are not suitable for legal or surveying purposes. Maps represent only the approximate location of boundaries.
-	This report is intended for internal DFO use only. Privacy screening [i.e., the rule of 5; see @DFO2020_RuleOfFive] is not yet integrated into all data products and summaries generated by the report.
-	Outputs of this report are not suitable for real-time, dynamic spatial planning.
-	Because coastal areas of the Scotian Shelf bioregion are generally not adequately sampled to characterize fine-scale ecological characteristics (i.e., species, habitat composition and variability within a sub-regional focal area), the distribution of (some) species featured within the report, when the search area is near to the coast, should be used as a first-order estimate limited by the spatial-temporal resolution of available data.

##### *Data Access & Quality Tiers*

This report incorporates information from a variety of sources with differing levels of accessibility and quality control. Consequently, data sources in the report are categorized based on data access considerations, tiers of data quality, and associated usage recommendations.

Security level considerations for data access are divided in three categories:

- Open Data: Data open to the public available in the public facing platform for spatial data within the Open Government Portal https://open.canada.ca/en/open-data
- Secure Data: Data products that are in the process of being published in Open Data, and/or data products that are available upon request to data providers/custodians, and not suitable for publication in open data.
- Protected B Data: Applies to information or assets that, if compromised, could cause serious injury to an individual, organization or government. https://www.tpsgc-pwgsc.gc.ca/esc-src/protection-safeguarding/niveaux-levels-eng.html

Tiers of data quality were developed by the report generators and data providers in order to provide guidance and urge caution when interpreting the data summaries. Note subjectivity remains in this classification; we welcome suggestions about how to improve this section to characterize information from a vast variety of sources.

```{r table-tiers-read, echo=FALSE, cache=FALSE, include = FALSE}
table_tier <- read.csv(here::here("app/data/misc/table_tiers_EN.csv"))
```

```{r tier-table}
knitr::kable(table_tier,align="l",
      caption = "Quality tiers defined to describe sources of information queried and summarized in this report.", booktabs = T, escape = F, linesep="") %>% kableExtra::kable_styling(bootstrap_options = "striped", full_width = T, position = "left")
```


<!-- MAIN SECTIONS -->

# **DATA DISCOVERY OUTPUTS**  
{{add_parts}}

<!-- GENERIC END -->

## **REGIONAL SYNTHESIS**

This section provides an overall synthesis of regional data and data products of human activities and species contained within the search area. This summary must be used in coordination with all the information presented throughout the report, including the descriptions, caveats, disclaimers, sources of uncertainty, references to the literature, and contacts who can provide further interpretation. This section is not intended to provide the data itself, but to summarize what is available. Users are encouraged to access the original data source if more information is required.

### **Multi-Threat Synthesis**

This section is a work-in-progress. It summarizes available information of human activities in the search area. Please contact data providers if data outside of these ranges are required. Outputs are not suitable for real-time, dynamic spatial planning.

```{r threat-class-table}
if (!is.null(rrEnv$haClassTable)) {
  absentCode <- "&nbsp;-&nbsp;"
  presentCode <- "&#x2714;"
  rrEnv$haClassTable[is.na(rrEnv$haClassTable)] <- FALSE

  rrEnv$haClassTable[rrEnv$haClassTable == FALSE] <- absentCode
  rrEnv$haClassTable[rrEnv$haClassTable == TRUE] <- presentCode

  haClassTable <-dplyr:: mutate_all(rrEnv$haClassTable, ~ kableExtra::cell_spec(., color = ifelse(. == presentCode, "white", ""), background = ifelse(. == presentCode, "green", ""), escape = FALSE))

}
```

```{r output-threat-class-table, eval=exists('haClassTable')}
knitr::kable(haClassTable, align="l", caption = "Classification of areas impacted by threats present in search area", booktabs = T, escape = F, linesep = "") %>%
  kableExtra::kable_styling(bootstrap_options = "striped", full_width = T, position = "left")
```

### **Multi-Species Synthesis**

This section summarizes available information of presence of species in the search area listed by SARA, and/or assessed by COSEWIC, per each data source presented in this report. The absence of a species in this report should be interpreted as an absence of observation or reporting of the species within the search area, not necessarily as a true absence of the species. Unless otherwise specified, data were queried from 2010 to present. Please contact data providers if data outside of these ranges are required. Outputs are not suitable for real-time, dynamic spatial planning.

```{r sar-obs-summary-table}
absentCode <- "&nbsp;-&nbsp;"
presentCode <- "&#x2714;"
summarySarTable[is.na(summarySarTable)] <- absentCode
formatedSarTable <-dplyr:: mutate_all(summarySarTable, ~ kableExtra::cell_spec(., color = ifelse(. == presentCode, "white", ""), background = ifelse(. == presentCode, "green", ""), escape = FALSE))

```

```{r sar-hab-summary-table}
  summaryHabTable[is.na(summaryHabTable)] <- "&nbsp;-&nbsp;"

  # add column for observations from sar table
  obsColumn <- apply(summarySarTable, 1, function(r) any(r %in% c(presentCode)))
  summaryHabTable$Obs <- ifelse(obsColumn, presentCode, absentCode)

  summaryHabTable <- dplyr::mutate_all(summaryHabTable, ~ kableExtra::cell_spec(., color = ifelse(. == presentCode, "white", ""),
                  background = ifelse(. == presentCode, "green", ""), escape = FALSE))

  names(summaryHabTable) <- c("Species", "COSEWIC", "SARA", "Observations", "SAR Range", "SDM", "Important Habitat", "Critical Habitat")


```

```{r output-hab-table}
knitr::kable(summaryHabTable, align="l", caption = "Regional synthesis of data and data products of species contained within the search area that are listed by the Species At Risk Act (SARA), and/or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). Data points (observations) are summarized in more detail in the subsequent table. A description of the different sources of information for Species at Risk is available in the infographic: https://github.com/dfo-mar-odis/shinySpatialApp/blob/master/app/data/misc/SAR-information-type-reproducible-reports.pdf). The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area. Outputs are not suitable for real-time, dynamic spatial planning.", booktabs = T, escape = F, linesep = "") %>%
  kableExtra::kable_styling(bootstrap_options = "striped", full_width = T, position = "left")
```

```{r output-sar-table}
knitr::kable(formatedSarTable, align="l", caption = "Summary of regional data points (observations) of species contained within the search area that are listed by the Species At Risk Act (SARA), and/or assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC). Presence of a species in at least one of these data sources is reported as a presence in the data points (observations) in the table above. The absence of a species in this table should be interpreted as an absence of reporting, not necessarily as an absence of the species in the area. Outputs are not suitable for real-time, dynamic spatial planning.", booktabs = T, escape = F, linesep = "") %>%
  kableExtra::kable_styling(bootstrap_options = "striped", full_width = T, position = "left")
```

# **CONTRIBUTORS**
```{r read-contributors, echo=FALSE, cache=FALSE, include = FALSE, results='asis'}
people <- read.csv(here::here("app/data/misc/contributors.csv"),  encoding="UTF-8")
people <- people$list
sort(people)
```
List of contributors (listed in alphabetical order) that have contributed with with data, context, and ideas for the reproducible reporting initiative: `r knitr::combine_words(people)`.

# **REFERENCES**    

<!-- APPENDIX -->
{{add_appendix}}

# **SUPPLEMENTARY MATERIAL 1**

```{r child = here::here("reports/sections/obis/obis-supplementary_en.Rmd")}
```

# **SUPPLEMENTARY MATERIAL 2**

```{r child = here::here("reports/sections/threats/ThreatMitigation-supplementary.Rmd")}
```
